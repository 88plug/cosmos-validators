---
- name: install unzip
  apt:
    name: unzip
    state: present

- name: download binary
  get_url:
    url: '{{ binary }}'
    dest: '/tmp/binary.zip'
    mode: '0700'
    force: yes

- name: unarchive binary
  unarchive:
    src: '/tmp/binary.zip'
    remote_src: yes
    dest: '/tmp'
    mode: '0644'

- name: copy the binary file
  copy:
    remote_src: true
    src: /tmp/injectived
    dest: '{{ user_dir }}/go/bin'
    mode: '0700'

- name: Initialize Node
  command: '{{ daemon }} init {{ validator_name }} --chain-id {{ chain_id }} -o'
  environment:
    PATH: '{{ path }}'

- name: Download genesis file
  get_url:
    url: '{{ genesis }}'
    dest: '{{ user_dir }}/{{ folder }}/config/genesis.json'
    mode: '0644'

- name: Update minimum gas price on config file
  lineinfile:
    path: '{{ user_dir }}/{{ folder }}/config/app.toml'
    regexp: 'minimum-gas-prices '
    line: 'minimum-gas-prices = "{{ minimum_gas_price }}"'
    state: present

- name: Update the seeds
  lineinfile:
    path: '{{ user_dir }}/{{ folder }}/config/config.toml'
    regexp: 'seeds = ""'
    line: 'seeds = "{{ seeds }}"'
    state: present

- name: Update commit_timeout
  lineinfile:
    path: '{{ user_dir }}/{{ folder }}/config/config.toml'
    regexp: 'timeout_commit = "1s"'
    line: 'timeout_commit = "1500ms"'
    state: present
